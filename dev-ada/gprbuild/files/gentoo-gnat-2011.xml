<?xml version="1.0" ?>
<gprconfig>
  <!-- Current GNAT compiler in Gentoo -->
  <compiler_description>
    <name>GNAT-Gentoo</name>
    <executable prefix="1">(.*-.*)?gnatmake</executable>
    <version>
      <external>gnatls -v</external>
      <grep regexp="^GNATLS.+?(\d+(\.\d+)?)" group="1"></grep>
    </version>
    <variable name="adalib_dir">
      <getenv name="ADA_OBJECTS_PATH"/>
      <grep regexp="[^:]*/adalib"></grep>
    </variable>
    <languages>Ada</languages>
    <runtimes default="default,kernel">
       <directory group="default" >$adalib_dir</directory>
       <directory group="1" >$adalib_dir/\.\./rts-(.*)/adalib/</directory>
    </runtimes>
    <target>
      <external>gnatgcc -dumpmachine</external>
      <grep regexp="[^\r\n]+"></grep>
    </target>
  </compiler_description>

  <!-- This is copy of gnat.xml with a few excpetions: -->
  <!-- Specify Compiler Driver as gnatgcc -->
  <!-- Specify -RTS=... due to gprlib overrides ADA_OBJECTS_PATH -->
  <configuration>
   <compilers>
     <compiler name="GNAT-Gentoo" />
   </compilers>
   <config>
   package Naming is
      for Spec_Suffix ("Ada") use ".ads";
      for Body_Suffix ("Ada") use ".adb";
      for Casing use "lowercase";
      for Dot_Replacement use "-";
   end Naming;

   package Compiler is
      for Driver ("Ada") use "${PATH(ada)}${PREFIX(ada)}gnatgcc";
      for Leading_Required_Switches        ("Ada") use
          Compiler'Leading_Required_Switches ("Ada")
            &amp; ("-c", "-x", "ada", "-gnatA",
                   "--RTS=${RUNTIME_DIR(ada)}/..");
      for Mapping_File_Switches    ("Ada") use ("-gnatem=");
      for Mapping_Spec_Suffix      ("Ada") use "%s";
      for Mapping_Body_Suffix      ("Ada") use "%b";
      for Config_File_Switches     ("Ada") use ("-gnatec=");
      for Include_Path_File     ("Ada") use "ADA_PRJ_INCLUDE_FILE";
   end Compiler;

   package Binder is
      for Objects_Path_File     ("Ada") use "ADA_PRJ_OBJECTS_FILE";
      for Required_Switches     ("Ada") use
          Binder'Required_Switches ("Ada")  &amp; ("-I-",
		 "--RTS=${RUNTIME_DIR(ada)}/..");
      for Driver         ("Ada") use
          "${GPRCONFIG_PREFIX}libexec/gprbuild/gprbind";
   end Binder;

   for Toolchain_Version     ("Ada") use "GNAT ${VERSION(ada)}";
   for Runtime_Library_Dir   ("Ada") use "${RUNTIME_DIR(ada)}";
   for Runtime_Source_Dir    ("Ada") use "${RUNTIME_DIR(ada)}/../adainclude";
   </config>

  </configuration>

  <!--  Whether -fPIC is needed -->
  <configuration>
   <compilers>
     <compiler name="GNAT-Gentoo" />
   </compilers>
   <targets negate="true">
      <target name="^.*lynxos.*$" />
      <target name="^.*mingw.*$" />
      <target name="^.*dec-osf.*$" />
      <target name="^.*vms.*$" />
   </targets>
   <config>
   package Compiler is
      for PIC_Option      ("Ada") use ("-fPIC");
   end Compiler;
   </config>
  </configuration>

  <!-- add compiler option -msoft-float when the runtime is soft-float -->
  <configuration>
   <compilers>
     <compiler name="GNAT-Gentoo" runtime="soft-float" />
   </compilers>
   <config>
   package Compiler is
      for Leading_Required_Switches ("Ada") use
        Compiler'Leading_Required_Switches ("Ada") &amp; ("-msoft-float");
   end Compiler;
   </config>
  </configuration>

  <!-- This is copy of gnat.xml with an excpetion: -->
  <!-- Specify Linker Driver as gnatgcc -->
  <configuration>
    <targets>
       <target name="^.*linux.*$" />
    </targets>
    <compilers>
       <compiler name="GNAT-Gentoo" />
    </compilers>
    <config>
   for Library_Partial_Linker use ("${PATH(ada)}${PREFIX(ada)}gnatgcc", "-nostdlib", "-Wl,-r", "-o");
   for Run_Path_Option  use ("-Wl,-z,origin,-rpath,");
   for Run_Path_Origin use "$$ORIGIN";

   package Linker is
      for Map_File_Option         use "-Wl,-Map,";
   end Linker;
    </config>
  </configuration>

</gprconfig>
